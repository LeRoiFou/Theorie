<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OVH - Chapitre V</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <h1>Chapitre V : Approfondissement</h1>
    <br>

    <hr>

    <ul>
        <li>
            <p>Acc√®s limite au site par adresse IP</p>
        </li>
        <li>
            <p>OVHcloud SecNumCloud ?</p>
        </li>
    </ul>

    <!-- *************** Menu ********************* -->
    <hr>
    <div>
        <p><u><strong>Menu :</strong></u></p>
        <ol id="menu" type="1">
            <li><a href="#chap1">Mise √† jour de l'application</a></li>
            <li><a href="#chap2">Monitoring</a></li>
            <li></li>
        </ol>
    </div>

    <a id='lien' href="./index.html">Retour au sommaire</a>
    <hr>

    <!-- *************** Zone de saisie *************** -->
    <div class="questions">
        <label for="network">Ancien port r√©seau</label>
        <input type="text" name="network" id="network" placeholder="8000 pour fastapi, 8050 pour dash"><br>

        <label for="new">Nouveau port r√©seau</label>
        <input type="text" name="new" id="new" placeholder="Par exemple 8001 pour fastapi, 8051 pour dash"><br>

        <label for="repository">REPOSITORY</label>
        <input type="text" name="repository" id="repository"
            placeholder="Nom de la nouvelle image √† charger (en local : docker images)"
            title="Charger pr√©alablement docker desktop"><br>

        <label for="tag">TAG</label>
        <input type="text" name="tag" id="tag"
            placeholder="Version de la nouvelle image √† charger  (en local : docker images)"
            title="Par d√©faut, le nom de la version de l'image est latest"><br>

        <label for="container">CONTAINER ID</label>
        <input type="text" name="container" id="container"
            placeholder="ID du conteneur √† supprimer (en VM : docker ps-a)"><br>

        <label for="image">IMAGE</label>
        <input type="text" name="image" id="image"
            placeholder="Suppression de l'ancienne image (en VM : docker ps)"><br>

        <label for="ipv4">Adresse IPv4</label>
        <input type="text" name="ipv4" id="ipv4" placeholder="Adresse IPv4 sur OVH du projet cibl√©"><br>

    </div>

    <button type="submit" id="btn">Valider</button><br>

    <!-- Chapitre I -->
    <h2 id="chap1">1. Mise √† jour de l'application</h2>

    <table>
        <thead>
            <tr>
                <th width="70px">Shell</th>
                <th>Motif</th>
                <th>Explications</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="3"><i>Dock√©riser √† nouveau le script</i></td>
            </tr>
            <tr>
                <td colspan="3">Sur le site OVH, apr√®s avoir s√©lectionn√© le projet, aller sur le menu √† gauche ‚Üí
                    partie "COMPUTE" ‚Üí sous-partie "Instances" (le statut doit √™tre en mode "activ√©")</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>docker save <span id="repoResponse1">REPOSITORY</span>:<span id="tagResponse1">TAG</span> -o <span
                        id="repoResponse2">REPOSITORY</span>.tar</code></pre>
                </td>
            </tr>
            <tr>
                <td>Local</td>
                <td>Exporte l‚Äôimage modifi√©e en dossier archiv√© .tar sur le PC</td>
                <td><b>-o</b> : <i>signifie output</i></td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>ls <span id="repoResponse3">REPOSITORY</span>.tar</code></pre>
                </td>
            </tr>
            <tr>
                <td>Local</td>
                <td>V√©rifie que le dossier archiv√© .tar a bien √©t√© cr√©√© en local</td>
                <td><b>ls</b> : <i>signifie ‚Äúlist‚Äù : elle sert √† lister les fichiers et dossiers d‚Äôun
                        r√©pertoire</i></td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>scp -i $env:USERPROFILE\.ssh\id_ed25519 <span id="repoResponse4">REPOSITORY</span>.tar
                    ubuntu@<span id="ipv4Response1">IPv4</span>:/home/ubuntu/</code></pre>
                </td>
            </tr>
            <tr>
                <td>Local</td>
                <td>Copier le dossier archiv√© .tar vers la VM OVH</td>
                <td>
                    <ul>
                        <li><b>scp</b> : <i>signifie Secure Copy Protocol. C‚Äôest la commande qui permet
                                de copier des fichiers de fa√ßon s√©curis√©e entre le PC et la VM en
                                utilisant le protocole SSH (chiffrement, m√™me port 22)</i></li>
                        <li><b>-i</b> : <i>signifie quel fichier de cl√© priv√©e utiliser pour l‚Äôauthentification></li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>ssh -i $env:USERPROFILE\.ssh\id_ed25519 ubuntu@<span id="ipv4Response2">IPv4</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>Local</td>
                <td>Connexion au shell de la VM</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>docker load -i <span id="repoResponse5">REPOSITORY</span>.tar</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Charge l'image dans Docker sur la VM</td>
                <td><b>-i</b> : <i>signifie input : elle indique √† Docker de quel
                        fichier .tar il doit lire
                        l‚Äôimage √† importer
                    </i></td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>docker images</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>V√©rifie que l'image dans Docker a bien √©t√© charg√©e sur la VM</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>docker run -d --name <span id="repoResponse6">REPOSITORY</span> -p <span
                        id="newResponse1">NouveauPort:NouveauPort</span> <span
                        id="repoResponse7">REPOSITORY</span>:latest</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Lance le nouveau conteneur sur un port diff√©rent</td>
                <td>
                    <ul>
                        <li><b>-d</b> : <i>mode d√©tach√© (en arri√®re-plan)</i></li>
                        <li><b>-p <span id="networkResponse2">PortReseau:PortReseau</span></b> :
                            <i>mappe le port r√©seau de la VM vers
                                le port r√©seau dans le conteneur</i>
                        </li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>docker ps</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Teste que les deux conteneurs tournent</td>
                <td><b>ps</b> : <i>vient de ‚Äúprocess status‚Äù. Historiquement, ps est une commande Unix qui
                        affiche l‚Äô√©tat des processus en cours, et Docker a repris ce nom pour
                        afficher l‚Äô√©tat des conteneurs</i></td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>docker rm -f <span id="contResponse">CONTAINER ID</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Suppression forc√©e de l'ancien conteneur</td>
                <td><b>rm -f</b> : <i>suppression forc√©e</i> <br><br><strong>On ne peut plus se connecter sur
                        l'application</strong>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>docker stop <span id="repoResponse8">REPOSITORY</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Arr√™t du nouveau conteneur</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>docker rm <span id="repoResponse9">REPOSITORY</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Suppression du nouveau conteneur</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>docker run -d --restart unless-stopped --name <span id="repoResponse10">REPOSITORY</span>-container -p <span id="networkResponse1">PortReseau:PortReseau</span> <span id="repoResponse11">REPOSITORY</span>:<span id="tagResponse2">TAG</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Lancement de l'application</td>
                <td><strong>On peut se reconnecter √† nouveau sur l'application</strong></td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>docker ps</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>V√©rifie que l'application a bien √©t√© lanc√©e</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>docker rmi <span id="imageResponse">IMAGE</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Nettoye l'ancienne image</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>docker ps -a</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>V√©rifie que l'ancienne image a bien √©t√© supprim√©e</td>
                <td>-</td>
            </tr>
        </tbody>
    </table><br>

    <p><strong><i>NB : pour √©viter toute rupture de connexion lors de la mise √† jour de l'application, il est pr√©f√©rable
                de recourir √† la fonctionnalit√© "load balancer"</i></strong></p>

    <i><a href="#menu">Retour au menu</a></i><br><br>

    <!-- Chapitre II -->
    <h2 id="chap2">2. Monitoring</h2>

    <table>
        <thead>
            <tr>
                <th>Shell</th>
                <th>Motif</th>
                <th>Explications</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="3">Sur OVH, cliquer sur le nom de l'instance (couleur bleue) pour afficher les donn√©es
                    statistiques
                    (menu √† gauche ‚Üí partie "COMPUTE" ‚Üí sous-partie "Instances") <br><br>
                    <i>NB : certaines instances comme le mod√®le "Discovery" ne permettent pas d'afficher les
                        graphiques</i>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>ssh -i $env:USERPROFILE\.ssh\id_ed25519 ubuntu@<span id="ipv4Response3">IPv4</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>Local</td>
                <td>Connexion au shell de la VM</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3"><strong><i>Si c'est la premi√®re fois que les donn√©es statistiques sont analys√©es pour
                            cette instance :</i></strong></td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>sudo apt update</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Mise √† jour des paquets disponibles</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>sudo apt install nload -y</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Installation du paquet nload</td>
                <td><b>-y</b> : <i>l‚Äôoption -y signifie ‚Äúassume yes‚Äù üëâ elle r√©pond automatiquement ‚Äúyes‚Äù √† toutes les
                        questions pos√©es par apt pendant l‚Äôinstallation</i></td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>nload</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Acc√®s aux donn√©es statistiques</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3"><strong><i>Si ce n'est pas la premi√®re que les donn√©es statistiques sont effectu√©es pour
                            cette instance : </i></strong></td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>nload</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Acc√®s aux donn√©es statistiques</td>
                <td>-</td>
            </tr>
        </tbody>
    </table><br>

    <p><b>Donn√©es restitu√©es dans le shell : </b></p>

    <table>
        <thead>
            <tr>
                <th>√âl√©ment</th>
                <th>R√¥le</th>
                <th>D√©tail</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Incoming</td>
                <td>Trafic entrant</td>
                <td>Donn√©es qui arrivent sur la VM (requ√™tes HTTP, t√©l√©chargements, flux depuis Internet, etc.). </td>
            </tr>
            <tr>
                <td>Outgoing</td>
                <td>Trafic sortant</td>
                <td>Donn√©es qui partent de la VM (r√©ponses HTTP, envoi de fichiers, etc.). </td>
            </tr>
            <tr>
                <td>Curr</td>
                <td>D√©bit instantan√©</td>
                <td>D√©bit mesur√© au dernier rafra√Æchissement, en kBit/s ou MBit/s selon la valeur.</td>
            </tr>
            <tr>
                <td>Avg</td>
                <td>D√©bit moyen</td>
                <td>Moyenne du d√©bit sur une fen√™tre de temps r√©cente (par d√©faut ‚âà 5 minutes). </td>
            </tr>
            <tr>
                <td>Min</td>
                <td>D√©bit minimum</td>
                <td>Plus faible d√©bit observ√© pendant la session en cours de nload. </td>
            </tr>
            <tr>
                <td>Max</td>
                <td>D√©bit maximum</td>
                <td>Pic de d√©bit observ√© pendant la session en cours de nload. </td>
            </tr>
            <tr>
                <td>Ttl</td>
                <td>Volume total</td>
                <td>Quantit√© totale de donn√©es transf√©r√©es depuis le lancement de nload, en kByte/MByte/GByte. </td>
            </tr>
        </tbody>
    </table><br>

    <i><a href="#menu">Retour au menu</a></i><br><br>


    <a id='lien' href="./index.html">Retour au sommaire</a>

    <script src="script_ovh5.js"></script>
</body>

</html>