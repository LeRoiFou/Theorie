<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OVH - Chapitre IV</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <h1>Chapitre IV : DNS</h1>
    <br>

    <p><b>❗Cette fiche est à suivre une fois qu'un nom de domaine a été acheté</b></p>

    <!-- *************** Menu ********************* -->
    <hr>
    <div>
        <p><u><strong>Menu :</strong></u></p>
        <ol id="menu" type="1">
            <li><a href="#chap1">Création du site Web</a></li>
            <li><a href="#chap2">Mise à jour future du site web</a></li>
        </ol>

        <a id='lien' href="./index.html">Retour au sommaire</a>
    </div>
    <hr>


    <!-- *************** Zone de saisie *************** -->
    <div class="questions">

        <label for="key">Nom de la clé privée</label>
        <input type="text" name="key" id="key" value="id_ed25519"
            title="Nom par défaut de la clé privée attribué par OVH"><br>

        <label for="ipv4">Adresse IPv4</label>
        <input type="text" name="ipv4" id="ipv4" placeholder="Adresse IPv4 sur OVH du domaine rattaché"><br>

        <label for="domain">Nom du domaine</label>
        <input type="text" name="domain" id="domain">

        <label for="directory">Répertoire cible</label>
        <input type="text" name="directory" id="directory" placeholder="Fichiers HTML, CSS à récupérer en local">

        <label for="htmlFile">Nom du fichier HTML</label>
        <input type="text" name="htmlFile" id="htmlFile">

        <label for="cssFile">Nom du fichier CSS</label>
        <input type="text" name="cssFile" id="cssFile">

    </div>

    <button type="submit" id="btn">Valider</button><br>

    <!-- Chapitre I -->
    <h2 id="chap1">1. Création du site Web</h2>

    <table>
        <thead>
            <tr>
                <th width="70px">Shell</th>
                <th>Motif</th>
                <th>Explications</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="3">
                    <pre><code>ssh -i $env:USERPROFILE\.ssh\<span id="keyResponse1">id_ed25519</span> ubuntu@<span id="ipv4Response1">IPv4</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>Local</td>
                <td>Connexion à la VM</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>sudo mkdir -p /var/www/<span id="domainResponse1">NomDomaine</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Création du dossier comprenant les fichiers HTML, CSS...</td>
                <td>
                    <ul>
                        <li><b>sudo</b> : <i>exécute la commande avec les droits administrateur (root), nécessaires pour
                                écrire dans /var</i></li>
                        <li><b>mkdir</b> : <i>“make directory” → crée un dossier</i></li>
                        <li><b>p</b> :
                            <ul>
                                <li><i>crée aussi les dossiers parents manquants</i></li>
                                <li><i>ne génère pas d’erreur si le dossier existe déjà</i></li>
                            </ul>
                        </li>
                        <li><b>/var/www/NomDomaine</b> : <i>chemin complet du dossier à créer, qui servira de répertoire
                                racine pour le site (là où mettre index.html, style.css, etc.)</i></li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>cd <span id="directoryResponse1">RepertoireCible</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>
                    Local
                </td>
                <td>Accès au dossier contenant les fichiers HTML, CSS... à récupérer</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>scp <span id="htmlFileResponse1">FichierHTML</span>.html <span id="cssFileResponse1">fichierCSS</span>.css ubuntu@<span id="ipv4Response2">IPv4</span>:/tmp/</code></pre>
                </td>
            </tr>
            <tr>
                <td>Local</td>
                <td>Envoie des fichiers HTML, CSS... sur la VM</td>
                <td><b>/tmp/</b> : <i>répertoire temporaire standard de Linux</i>
                    <ul>
                        <li><i>Tous les utilisateurs peuvent y écrire</i></li>
                        <li><i>Les fichiers qui s’y trouvent sont considérés comme temporaires (ils peuvent être
                                supprimés au redémarrage, selon la config)</i></li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>ssh -i $env:USERPROFILE\.ssh\<span id="keyResponse2">id_ed25519</span> ubuntu@<span id="ipv4Response3">IPv4</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Connexion à la VM</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>sudo mv /tmp/<span id="htmlFileResponse2">FichierHTML</span>.html /var/www/<span id="domainResponse2">NomDomaine</span>/</code></pre>
                    <pre><code>sudo mv /tmp/<span id="cssFileResponse2">fichierCSS</span>.css /var/www/<span id="domainResponse3">NomDomaine</span>/</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Déplacement des fichiers sur la VM au bon endroit</td>
                <td><b>sudo mv</b> : <i>Déplacement des fichier (mv = move) en tant qu'administrateur (sudo)</i></td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>sudo nano /etc/nginx/sites-available/<span id="domainResponse4">NomDomaine</span>.fr</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Configuration du paquet Nginx pour le domaine</td>
                <td>
                    <ul>
                        <li><b>nano</b> : <i>ouvrir l’éditeur de texte Nano en mode texte dans le terminal. S’il n’y a
                                pas encore de fichier à ce chemin, Nano en crée un nouveau à l’enregistrement</i></li>
                        <li><b>/etc/nginx/</b> : <i>dossier de configuration de Nginx</i></li>
                        <li><b>sites-available</b> : répertoire où l’on stocke tous les fichiers de configuration de
                            sites (vhosts) disponibles</li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>server {
    listen 80;
    server_name <span id="domainResponse5">NomDomaine</span>.fr www.<span id="domainResponse6">NomDomaine</span>.fr;

    root /var/www/<span id="domainResponse7">NomDomaine</span>;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }
}
</code></pre> Puis : <br>
                    CTRL + O (Entrer la commande) <br>
                    CTRL + X (Quitter la commande)
                </td>
            </tr>
            <tr>
                <td rowspan="6">VM</td>
                <td>
                    <pre><code>server {}</code></pre>
                </td>
                <td><i>Bloc server : tout ce qui est à l’intérieur définit la configuration d’un site ou d’un
                        sous-ensemble de sites (un vhost)</i></td>
            </tr>
            <tr>
                <td>
                    <pre><code>listen 80;</code></pre>
                </td>
                <td>
                    <ul>
                        <li><i>Nginx écoute sur le port 80 (HTTP)</i></li>
                        <li><i>Toutes les requêtes arrivant sur cette VM en HTTP port 80 peuvent être traitées par ce
                                bloc, si le server_name correspond</i></li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td>
                    <pre><code>server_name NomDomaine.fr www.NomDomaine.fr;</code></pre>
                </td>
                <td>
                    <ul>
                        <li><i>Liste des noms de domaines gérés par ce vhost</i></li>
                        <li><i>Si la requête HTTP contient l’en-tête Host: NomDomaine.fr ou Host:
                                www.NomDomaine.fr, Nginx
                                utilisera ce bloc server pour répondre</i></li>
                        <li><i>C’est ce qui permet d’avoir plusieurs sites différents sur la même IPv4, distingués par
                                le nom</i></li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td>
                    <pre><code>root /var/www/NomDomaine;</code></pre>
                </td>
                <td>
                    <ul>
                        <li><i>Chemin du dossier racine du site sur la VM</i></li>
                        <li><i>Nginx ira chercher les fichiers statiques (HTML, CSS, images…) dans
                                /var/www/NomDomaine</i></li>
                        <li><i>Par exemple, une requête pour http://NomDomaine.fr/image.png correspondra au
                                fichier
                                /var/www/NomDomaine/image.png</i></li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td>
                    <pre><code>index FichierHTML.html;</code></pre>
                </td>
                <td>
                    <ul>
                        <li><i>Fichier par défaut à servir quand l’URL ne mentionne pas de fichier précis</i></li>
                        <li><i>Pour http://NomDomaine.fr/, Nginx servira /var/www/NomDomaine/index.html</i></li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td>
                    <pre><code>location / {try_files $uri $uri/ =404;}</code></pre>
                </td>
                <td>
                    <ul>
                        <li><i>Bloc location / : règles pour toutes les URL commençant par / (donc tout le site)</i>
                        </li>
                        <li><i>try_files $uri $uri/ =404; signifie :</i></li>
                        <ul>
                            <li><i>Essaie de servir le fichier correspondant au chemin demandé ($uri)</i></li>
                            <li><i>Si ce n’est pas un fichier, essaie comme un dossier ($uri/)</i></li>
                            <li><i>Si rien n’existe, renvoie une erreur 404</i></li>
                        </ul>
                        <li><i>C’est une façon simple et sécurisée de ne servir que des fichiers réellement présents
                                dans /var/www/NomDomaine</i></li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>sudo ln -s /etc/nginx/sites-available/<span id="domainResponse8">NomDomaine</span>.fr /etc/nginx/sites-enabled/ 2>/dev/null || true sudo nginx -t sudo systemctl restart nginx
</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Active et redémarre le site web</td>
                <td>A compléter</td>
            </tr>
            <tr>
                <td colspan="3">Dans OVHcloud → Web Cloud → Noms de domaine → <span
                        id="domainResponse9">NomDomaine</span>.fr → Zone DNS :
                    <ul> Verifier que :
                        <li><span id="domainResponse10">NomDomaine</span>.fr → type A → cible <span
                                id="ipv4Response4">IPv4</span></li>
                        <li>www → type A → cible <span id="ipv4Response5">IPv4</span></li>
                    </ul>
                </td>
            </tr>
        </tbody>
    </table><br>

    <i><a href="#menu">Retour au menu</a></i><br><br>

    <!-- Chapitre II -->
    <h2 id="chap2">2. Mise à jour future du site web</h2>

    <table>
        <thead>
            <tr>
                <th width="70px">Shell</th>
                <th>Motif</th>
                <th>Explications</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="3">
                    <pre><code>cd <span id="directoryResponse2">RepertoireCible</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>Local</td>
                <td>Accès au dossier contenant les fichiers HTML, CSS... à récupérer</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>scp <span id="htmlFileResponse3">FichierHTML</span>.html <span id="cssFileResponse3">fichierCSS</span>.css ubuntu@<span id="ipv4Response6">IPv4</span>:/tmp/</code></pre>
                </td>
            </tr>
            <tr>
                <td>Local</td>
                <td>Envoie des fichiers HTML, CSS... sur la VM</td>
                <td><b>/tmp/</b> : <i>A compléter</i></td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>ssh -i $env:USERPROFILE\.ssh\<span id="keyResponse3">id_ed25519</span> ubuntu@<span id="ipv4Response7">IPv4</span></code></pre>
                </td>
            </tr>
            <tr>
                <td>Local</td>
                <td>Connexion à la VM</td>
                <td>-</td>
            </tr>
            <tr>
                <td colspan="3">
                    <pre><code>sudo mv /tmp/<span id="htmlFileResponse4">FichierHTML</span>.html /var/www/<span id="domainResponse11">NomDomaine</span>/</code></pre>
                    <pre><code>sudo mv /tmp/<span id="cssFileResponse4">fichierCSS</span>.css /var/www/<span id="domainResponse12">NomDomaine</span>/</code></pre>
                </td>
            </tr>
            <tr>
                <td>VM</td>
                <td>Déplacement des fichiers sur la VM au bon endroit</td>
                <td><b>sudo mv</b> : <i>A compléter</i></td>
            </tr>
        </tbody>
    </table><br>

    <i><a href="#menu">Retour au menu</a></i><br><br>

    <a id='lien' href="./index.html">Retour au sommaire</a>

    <script src="script_ovh4.js"></script>

</body>

</html>